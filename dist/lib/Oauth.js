"use strict";var __importDefault=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:!0});const Error_1=require("../Error"),axios_1=__importDefault(require("axios"));class Auth{constructor(r){if(!r)throw new Error_1.MissingParamError("missing oauth");this.token=r}async get(r){return new Promise((async(e,i)=>{r.client_id||i(new Error_1.MissingParamError("missing client id")),r.client_secret||i(new Error_1.MissingParamError("missing client secret"));const t=this.token;try{const{data:i}=await axios_1.default({method:"post",url:"https://accounts.spotify.com/api/token",params:{grant_type:"client_credentials",token:t,client_id:r.client_id,client_secret:r.client_secret},headers:{"Content-Type":"application/x-www-form-urlencoded"}});e(i.access_token)}catch(r){i(new Error_1.UnexpectedError(r))}}))}async refresh(r,e){return new Promise((async(i,t)=>{r.client_id||t(new Error_1.MissingParamError("missing client id")),r.client_secret||t(new Error_1.MissingParamError("missing client secret")),r.redirect_uri||t(new Error_1.MissingParamError("missing redirect uri")),e||t(new Error_1.MissingParamError("missing token"));try{const{data:t}=await axios_1.default({method:"post",url:"https://accounts.spotify.com/api/token",params:{grant_type:"authorization_code",code:e,redirect_uri:r.redirect_uri},headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+Buffer.from(r.client_id+":"+r.client_secret).toString("base64")}});i(t)}catch(r){t(new Error_1.UnexpectedError(r))}}))}build(r){if(!r.client_id)throw new Error_1.MissingParamError("missing client id");if(!r.client_secret)throw new Error_1.MissingParamError("missing client secret");if(!r.redirect_uri)throw new Error_1.MissingParamError("missing redirect uri");return"https://accounts.spotify.com/en/authorize?client_id="+r.client_id+"&redirect_uri="+r.redirect_uri+"&response_type=code"}}exports.default=Auth;
